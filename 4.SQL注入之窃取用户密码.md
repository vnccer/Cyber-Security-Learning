# 攻击与分析过程
## 发现漏洞
1. DVWA Security级别设置为low
2. 进入SQL Injection模块，输入单引号'，结果：<img width="904" height="32" alt="image" src="https://github.com/user-attachments/assets/a0de06fd-7f05-4034-bc07-c73b55872445" />
3. 说明服务器后台把输入拼接到了SQL查询语句，如``SELECT first_name, last_name FROM users WHERE user_id = '我的输入';`` ,当输入单引号'后，这里变成了``... WHERE user_id = ''';``，这里再语法上错误，数据库报错，那么这里存在SQL注入漏洞。
## 构造Payload
1. **猜测列数**：为搞清后台`SELECT`语句查询了几个字段（列），使用`ORDER BY`子句，从`ORDER BY 1`开始尝试，直到报错
2. **利用UNION窃取信息**
   - `1' UNION SELECT database(), version()#`
   - `1`让查询功能正常开始，而`'`提前“关闭”了原本代码里等待输入的框
   - 原本代码可能是`... WHERE user_id = '我的输入'`，但输入后变成了`... WHERE user_id = '1''`
   - `UNION SELECT`是SQL命令：联合查询，告诉数据库：“正常查完ID为1的用户信息后，顺便帮我查一个新的东西，然后把两个结果合并显示”
   - `database(), version()`：这是让数据库帮我们查的“新东西”，`database()`：获取数据库名字，`version()`：获取数据库版本
   - `#`：注释符，从此开始，后面的代码忽略掉。
   - 总结：用`'`骗过服务器，再用`UNION SELECT`命令它在正常显示用户名的同时，把`数据库名字`和`版本号`显示出来，用`#`确保命令不会出错。
3. 

## 总结
1. `SELECT user, password FROM users WHERE user_id = '1';`:从用户表里，把id是1的那个人的用户名和密码给我看
2. `ORDER BY`是排序指令：
   - `ORDER BY 1`指：按照你查出来的第一列结果进行排序
   - `ORDER BY 2`指：按照你查出来的第二列结果进行排序
3. 由于不清楚网站后台的`SELECT`语句到底查了几列，因此去猜：
   - 发送`1' ORDER BY 1#`，服务器正常返回，至少有1列
   - 发送`1' ORDER BY 2#`，服务器正常返回，至少有2列
   - 发送`1' ORDER BY 3#`，服务器报错，原来的查询语句只查了2列，没有第3列来排序
4. 由于精确知道有2列，可以用UNION SELECT伪造一个同样是2列的查询，把想看的数据“拼接”到结果里.
