## 一、攻击流程：发现漏洞
- DVWA Security级别设置为low
- 进入SQL Injection模块，输入单引号'，结果：<img width="904" height="32" alt="image" src="https://github.com/user-attachments/assets/a0de06fd-7f05-4034-bc07-c73b55872445" />
- 说明服务器后台把输入拼接到了SQL查询语句，如``SELECT first_name, last_name FROM users WHERE user_id = '我的输入';`` ,当输入单引号'后，这里变成了``... WHERE user_id = ''';``，这里再语法上错误，数据库报错，那么这里存在SQL注入漏洞。
## 二、攻击流程：构造Payload
### 2.1 猜测列数
- 为搞清后台`SELECT`语句查询了几个字段（列），使用`ORDER BY`子句，从`ORDER BY 1`开始尝试，直到报错
### 2.2 利用UNION窃取信息
- Payload1:获取数据库版本和当前用户`1' UNION SELECT database(), version()#`
    - `1`让查询功能正常开始，而`'`提前“关闭”了原本代码里等待输入的框
    - 原本代码可能是`... WHERE user_id = '我的输入'`，但输入后变成了`... WHERE user_id = '1''`
    - `UNION SELECT`是SQL命令：联合查询，告诉数据库：“正常查完ID为1的用户信息后，顺便帮我查一个新的东西，然后把两个结果合并显示”
    - `database(), version()`：这是让数据库帮我们查的“新东西”，`database()`：获取数据库名字，`version()`：获取数据库版本
    - `#`：注释符，从此开始，后面的代码忽略掉。
    - 总结：用`'`骗过服务器，再用`UNION SELECT`命令它在正常显示用户名的同时，把`数据库名字`和`版本号`显示出来，用`#`确保命令不会出错。
- Payload2:窃取所有的数据库的表名
    - `1' UNION SELECT table_schema, table_name FROM information_schema.tables#`
    - `table_schema`：数据库的名称，如`dvwa`这个数据库；`table_name`：数据表的名字，如`users`表，`guestbook`表。
   - `FROM information_schema.tables`：是所有MySQL数据库里都内置的“公共信息库”，里面不存具体的用户数据，而是存着关于这个数据库服务器的所有“元数据”——如，服务器上有哪些数据库？每个数据库里有哪些表？每个表里有哪些列？`.table`是指定要看这个“电话本”里记录着所有表信息的那一页。
- Payload3:窃取`users`表的列名
    - `1' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name = 'users'#`
    - `table_name`：表的名字；`column_name`：列的名字（如`user_id`,`user`,`password`）
    - `.columns`页记录了每一个数据表里面所有列的名字，更详细
    - `WHERE`是条件是，缩短范围在`'users'`的表的列名
### 2.3 窃取用户名和密码(MD5哈希)
- Payload(最终):`1' UNION SELECT user, password FROM users#`
## 三、总结
- `SELECT user, password FROM users WHERE user_id = '1';`:从用户表里，把id是1的那个人的用户名和密码给我看
   `ORDER BY`是排序指令：
   - `ORDER BY 1`指：按照你查出来的第一列结果进行排序
   - `ORDER BY 2`指：按照你查出来的第二列结果进行排序
- 由于不清楚网站后台的`SELECT`语句到底查了几列，因此去猜：
   - 发送`1' ORDER BY 1#`，服务器正常返回，至少有1列
   - 发送`1' ORDER BY 2#`，服务器正常返回，至少有2列
   - 发送`1' ORDER BY 3#`，服务器报错，原来的查询语句只查了2列，没有第3列来排序
- 由于精确知道有2列，可以用UNION SELECT伪造一个同样是2列的查询，把想看的数据“拼接”到结果里.
